<div id="customer-modal" class="modal" role="dialog" aria-labelledby="customer-modal-title">
    <div class="modal-content">
        <h2 id="customer-modal-title">New Customer</h2>
        <form id="customer-form" method="POST" action="/customers">
            <div class="form-group">
                <label for="name" id="name-label">Customer Name</label>
                <input type="text" 
                       id="name" 
                       name="name" 
                       class="form-control" 
                       required 
                       tabindex="0"
                       aria-required="true"
                       aria-labelledby="name-label">
            </div>
            
            <div class="form-group">
                <label for="address" id="address-label">Address</label>
                <input type="text" 
                       id="address" 
                       name="address" 
                       class="form-control" 
                       required 
                       tabindex="0"
                       aria-required="true"
                       aria-labelledby="address-label">
            </div>
            
            <div class="form-group">
                <label for="email" id="email-label">Email</label>
                <input type="email" 
                       id="email" 
                       name="email" 
                       class="form-control" 
                       required 
                       tabindex="0"
                       aria-required="true"
                       aria-labelledby="email-label">
            </div>
            
            <div class="form-actions">
                <button type="button" id="cancel-button" class="btn-cancel" tabindex="0">Cancel</button>
                <button type="submit" id="save-button" class="btn-submit" tabindex="0">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('customer-form');
        
        // Cancel button logic
        document.getElementById('cancel-button').addEventListener('click', () => {
            // Close the modal by setting display to none
            const modal = document.getElementById('customer-modal');
            if (modal) {
                modal.style.display = 'none';
                
                // Also completely remove the modal from the DOM to prevent issues with multiple instances
                if (modal.parentNode) {
                    modal.parentNode.removeChild(modal);
                }
            }
        });
        
        // Form submission logic
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const formObject = {};
            
            formData.forEach((value, key) => {
                formObject[key] = value;
            });
            
            try {
                const response = await fetch('/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formObject)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Close modal and reload to show the new customer
                    const modal = document.getElementById('customer-modal');
                    if (modal) {
                        modal.style.display = 'none';
                        
                        // Also completely remove the modal from the DOM
                        if (modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                    }
                    
                    // Reload the page to show the new customer
                    window.location.reload();
                } else {
                    alert(result.error || 'Failed to save customer');
                }
            } catch (error) {
                console.error('Error saving customer:', error);
                alert('An error occurred. Please try again.');
            }
        });
    });
</script>